## Open eClass 2.3

Το repository αυτό περιέχει μια __παλιά και μη ασφαλή__ έκδοση του eclass.
Προορίζεται για χρήση στα πλαίσια του μαθήματος
[Προστασία & Ασφάλεια Υπολογιστικών Συστημάτων (ΥΣ13)](https://crypto.di.uoa.gr/csec/), __μην τη
χρησιμοποιήσετε για κάνενα άλλο σκοπό__.


## 2020 Project 1

Εκφώνηση: https://crypto.di.uoa.gr/csec/assets/projects/project1.pdf


### Μέλη ομάδας

- 1115201600014, Βαμβουρέλλης Ευστράτιος
- 1115201500139, Ρόκα Κωνσταντίνα

### Report

Συμπληρώστε εδώ __ένα report__ που
- Να εξηγεί τι είδους αλλαγές κάνατε στον κώδικα για να προστατέψετε το site σας (από την κάθε επίθεση).
- Να εξηγεί τι είδους επιθέσεις δοκιμάσατε στο αντίπαλο site και αν αυτές πέτυχαν.

### Αλλαγές
Προκειμένου να προστατεύσουμε το site μας από επιθέσεις, αρχικά ψάξαμε το site μέσω του UI, για να δούμε σε ποια σημεία περνάνε οι επιθέσεις μας. Έπειτα επικεντρωθήκαμε στον κώδικα του site ώστε να μην μας ξεφύγει κάτι. Στη συνέχεια ακολουθούν οι τρόποι αντιμετώπισης κάθε επίθεσης ξεχωριστά.

#### SQL INJECTION
Προκειμένου να προστατευτούμε από SQL injections, πέρα από τις δράσεις που κάναμε για τα xss (αναφέρεται παρακάτω), χρησιμοποιήσαμε prepared statements. Στο piazza του μαθήματος είδαμε αναφορά σε δύο τρόπους, pdo και mysqlnt. Δοκιμάσαμε και τα δύο για να δούμε πως δουλεύουν, αλλά στα περισσότερα σημεία χρησιμοποιήσαμε pdo prepared statements, γιατί μας βόλεψε πιο πολύ. Ψάχνοντας για τον τρόπο λειτουργίας των pdo p.s. είδαμε ότι δεν κάνει "πραγματικά" prepared statements by default και ότι μπορεί για αυτό το λόγο να είναι vulnerable σε συγκεκριμένες κωδικοποιήσεις. Το UTF-8 που χρησιμοποιείται στα πλαίσια της εργασίας ήταν ασφαλής κωδικοποίηση, αλλά για να είμαστε σίγουροι για την ασφάλειά μας απενεργοποιήσαμε τα emulated prepared statements. Τα prepared statements υλοποιήθηκαν για τα ερωτήματα που βρίσκονταν σε βασικά σημεία (πχ νέος χρήστης).

#### XSS
Προκειμένου να προστατευτούμε από xss, ψάξαμε σε όλα τα $_GET και $_POST του κώδικα (γύρω στα 900), ώστε να μην μας ξεφύγει κάτι. Στις μεταβλητές που περνούσαν από $_GET και $_POST εφαρμόσαμε τη συνάρτηση intval όταν αφορούσαν ακεραίους (πχ id) και τη συνάρτηση my_htmlspeacialchars για τις συμβολοσειρές αντί για τις htmlspeacialchars, htmlentities. Η συνάρτηση αυτή ουσιαστικά έτρεχε την htmlspecialchars με ένα έξτρα όρισμα για να την κάνει πιο ασφαλή.

#### CSRF
Οι επιλογές που είχαμε στο μυαλό μας για προστασία ενάντια στα csrf ήταν το same site cookie και το csrf token. Το same site cookie θεωρήσαμε πως δεν ήταν η σωστή επιλογή γιατί, όπως είπαμε και στις διαλέξεις, περιορίζει τη λειτουργικότητα του site. Επιλέξαμε λοιπόν να προσθέσουμε csrf token στις φόρμες σας. Επικεντρωθήκαμε κυρίως στις φόρμες του admin.

#### Remote File Inclusion
Παρατηρήσαμε ότι μπορούσαμε να δούμε όλα τα directories του project ακολουθώντας "ημιτελή" link. Επίσης, τα αρχεία που παραδίδονταν στις εργασίες αλλά και αυτά της ανταλλαγής αρχείων, αποθηκεύονταν σε subdirectories του φακέλου courses. Εφόσον μπορούσαμε να δούμε όλα τα αρχεία του project, μπορούσαμε να βρούμε που βρισκόταν το αρχείο που ανεβάζαμε και στη συνέχεια να το τρέξουμε! Προκειμένου να προστατευθούμε από επιθέσεις τέτοιου είδους, χρησιμοποιήσαμε .htaccess για να απαγορεύσουμε την πρόσβαση σε φακέλους τους οποίους δεν θα θέλαμε να δει ή να έχει πρόσβαση κάποιος.

#### Extra προστασίες
Παρατηρήσαμε ότι κάποια αρχεία ήταν προσβάσιμα από τους απλούς χρήστες ή και τους επισκέπτες, ενώ θα έπρεπε να τα βλέπει μόνο ο admin. Για να προστατεύσουμε αυτά τα αρχεία κάνουμε έλεγχο για το αν ο χρήστης μας είναι admin. Επιπλέον, κάποιες σελίδες που ήταν ανεξάρτητες από τις 4 υποχρεωτικές λειτουργίες αφαιρέθηκαν και η είσοδος σε αυτές απαγορεύθηκε με χρήση .htacces. Οι σελίδες του admin παρέμειναν όλες ενεργές και προστατευμένες.
